<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Place</title><script>const ws=new WebSocket('ws://localhost:8080');const tileColors={};var canvasSize=50,rateLimit=-1;ws.onmessage=(e)=>{if(!isNaN(e.data)){if(rateLimit===-1){rateLimit=parseInt(e.data);return}canvasSize=parseInt(e.data);return}const data=JSON.parse(e.data);tileColors[`${data.x},${data.y}`]=data.color};ws.onclose=()=>{location.reload()};ws.onopen=()=>{ws.send(window.location.hash.substring(window.location.hash.indexOf('access_token=')+13).split('&')[0].split('/')[0])};window.location.hash='';var canvas,chosenColor=null,ctx,tileSize=20,zoom=1,offsetX=0,offsetY=0,selectedTile=null,keysPressed={},velocity={x:0,y:0},maxSpeed=10,acceleration=0.4,deceleration=0.8;function resizeCanvas(){canvas.width=window.innerWidth;canvas.height=window.innerHeight}function drawGrid(){ctx.clearRect(0,0,canvas.width,canvas.height);const cols=Math.ceil(canvas.width/(tileSize*zoom))+2,rows=Math.ceil(canvas.height/(tileSize*zoom))+2,startX=Math.floor(offsetX)-Math.floor(cols/2),startY=Math.floor(offsetY)-Math.floor(rows/2);ctx.fillStyle='#000000';ctx.fillRect(0,0,canvas.width,canvas.height);var tileSizeTimesZoom=tileSize*zoom,tileSizeTimesZoomMinusOne=(tileSize-1)*zoom,floorColsDiv2=cols>>1,floorRowsDiv2=rows>>1;for(let x=startX;x<startX+cols;x++)for(let y=startY;y<startY+rows;y++){const color=tileColors[`${x},${y}`]||((Math.abs(x)<canvasSize&&Math.abs(y)<canvasSize)?'#ffffff':'#000000');ctx.fillStyle=color;const drawX=(x-offsetX+floorColsDiv2)*tileSizeTimesZoom,drawY=(y-offsetY+floorRowsDiv2)*tileSizeTimesZoom;ctx.fillRect(drawX,drawY,tileSizeTimesZoomMinusOne,tileSizeTimesZoomMinusOne)}}function handleTileClick(x,y){if(chosenColor){const confirmChange=confirm("Change the tile colour?");if(confirmChange){ws.send(JSON.stringify({x:x-1,y:y-2,color:chosenColor}))}}}document.addEventListener('keydown',(e)=>{keysPressed[e.key]=true});document.addEventListener('keyup',(e)=>{keysPressed[e.key]=false});function updateOffset(){if(keysPressed['ArrowUp']&&!keysPressed['ArrowDown'])velocity.y=Math.max(velocity.y-acceleration,-maxSpeed);else if(keysPressed['ArrowDown']&&!keysPressed['ArrowUp'])velocity.y=Math.min(velocity.y+acceleration,maxSpeed);else velocity.y=Math.abs(velocity.y)<deceleration?0:velocity.y+(velocity.y>0?-deceleration:deceleration);if(keysPressed['ArrowLeft']&&!keysPressed['ArrowRight'])velocity.x=Math.max(velocity.x-acceleration,-maxSpeed);else if(keysPressed['ArrowRight']&&!keysPressed['ArrowLeft'])velocity.x=Math.min(velocity.x+acceleration,maxSpeed);else velocity.x=Math.abs(velocity.x)<deceleration?0:velocity.x+(velocity.x>0?-deceleration:deceleration);offsetX+=velocity.x/(tileSize*zoom);offsetY+=velocity.y/(tileSize*zoom)}function animate(){updateOffset();drawGrid();requestAnimationFrame(animate);window.location.hash=(offsetX||offsetY||zoom)?`#x=${offsetX}&y=${offsetY}&zoom=${zoom}`:''}window.addEventListener('wheel',(e)=>{e.preventDefault();const zoomFactor=1.1;e.deltaY>0?zoom/=zoomFactor:zoom*=zoomFactor;zoom=Math.max(0.1,Math.min(zoom,10))});window.addEventListener('resize',resizeCanvas);window.addEventListener('keydown',(e)=>{if(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight'].includes(e.key))e.preventDefault()});function selectColour(button){const buttons=document.querySelectorAll('button');buttons.forEach((b)=>{b.classList.remove('selected')});button.classList.add('selected');switch(button.id){case 'red':chosenColor='#ff0000';break;case 'green':chosenColor='#00ff00';break;case 'blue':chosenColor='#0000ff';break;case 'yellow':chosenColor='#ffff00';break;case 'purple':chosenColor='#ff00ff';break;case 'cyan':chosenColor='#00ffff';break;case 'white':chosenColor='#ffffff';break;case 'black':chosenColor='#000000';break}}</script><style>body{margin:0;overflow:hidden;background-color:#eee}#colours{position:absolute;display:none}canvas{display:block}button{width:5vh;height:5vh;margin:0.5vh;border-radius:0;cursor:pointer;transition:all 0.1s}#red{background-color:#ff0000;border:0.5vh solid #aa0000}#green{background-color:#00ff00;border:0.5vh solid #00aa00}#blue{background-color:#0000ff;border:0.5vh solid #0000aa}#yellow{background-color:#ffff00;border:0.5vh solid #aaaa00}#purple{background-color:#ff00ff;border:0.5vh solid #aa00aa}#cyan{background-color:#00ffff;border:0.5vh solid #00aaaa}#white{background-color:#ffffff;border:0.5vh solid #aaaaaa}#black{background-color:#000000;border:0.5vh solid #333333}button:hover{transform:scale(1.1)}#red:active{box-shadow:0 0 1vh 1vh #aa0000}#green:active{box-shadow:0 0 1vh 1vh #00aa00}#blue:active{box-shadow:0 0 1vh 1vh #0000aa}#yellow:active{box-shadow:0 0 1vh 1vh #aaaa00}#purple:active{box-shadow:0 0 1vh 1vh #aa00aa}#cyan:active{box-shadow:0 0 1vh 1vh #00aaaa}#white:active{box-shadow:0 0 1vh 1vh #aaaaaa}#black:active{box-shadow:0 0 1vh 1vh #333333}#red.selected{box-shadow:0 0 0.5vh 0.5vh #aa0000}#green.selected{box-shadow:0 0 0.5vh 0.5vh #00aa00}#blue.selected{box-shadow:0 0 0.5vh 0.5vh #0000aa}#yellow.selected{box-shadow:0 0 0.5vh 0.5vh #aaaa00}#purple.selected{box-shadow:0 0 0.5vh 0.5vh #aa00aa}#cyan.selected{box-shadow:0 0 0.5vh 0.5vh #00aaaa}#white.selected{box-shadow:0 0 0.5vh 0.5vh #aaaaaa}#black.selected{box-shadow:0 0 0.5vh 0.5vh #333333}#colours{display:flex;flex-wrap:wrap;position:absolute;top:0;left:0;z-index:1}</style></head><body><div id="colours"><button onclick="selectColour(this)" id="red"></button><button onclick="selectColour(this)" id="green"></button><button onclick="selectColour(this)" id="blue"></button><button onclick="selectColour(this)" id="yellow"></button><button onclick="selectColour(this)" id="purple"></button><button onclick="selectColour(this)" id="cyan"></button><button onclick="selectColour(this)" id="white"></button><button onclick="selectColour(this)" id="black"></button></div><canvas id="canvas"></canvas><script>canvas=document.getElementById('canvas');ctx=canvas.getContext('2d');canvas.addEventListener('click',(e)=>{const rect=canvas.getBoundingClientRect(),mouseX=e.clientX-rect.left,mouseY=e.clientY-rect.top,x=Math.floor((mouseX/(tileSize*zoom))+offsetX-Math.floor(canvas.width/(tileSize*zoom)/2)),y=Math.floor((mouseY/(tileSize*zoom))+offsetY-Math.floor(canvas.height/(tileSize*zoom)/2));handleTileClick(x,y,e.clientX,e.clientY)});resizeCanvas();animate()</script></body></html>
